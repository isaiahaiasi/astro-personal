---
import type { MarkdownInstance } from "astro";
import BlogPost from "../../components/BlogPost.astro";
import BlogPostList from "../../components/BlogPostList.astro";
import ContentHeadingList from "../../components/ContentHeadingList.astro";
import Layout from "../../layouts/Layout.astro";
import { slugify } from "../../utils/slugify";

type PostResult = {
    params: {
        slug: string;
    };
    props?: {
        post: MarkdownInstance<Record<string, any>>;
    };
}[];

export async function getStaticPaths() {
    const posts = await Astro.glob("../../content/blog/*.md");
    const filteredPosts = posts.filter(({ frontmatter }) => !frontmatter.draft);

    const paths: PostResult = filteredPosts.map((post) => ({
        params: { slug: slugify(post.frontmatter) },
        props: { post },
    }));

    return paths;
}

const { post } = Astro.props;
const headings = post.getHeadings();
---

<Layout title={post.frontmatter.title}>
    <div class="container">
        <div class="sidebar left">
            <h2 class="text-gradient">Other Blog Posts</h2>
            <BlogPostList />
        </div>
        <main class="center-content">
            <BlogPost post={post} />
        </main>
        <div class="sidebar right">
            <h2 class="text-gradient">Table of Contents</h2>
            <ContentHeadingList
                headings={headings}
                title={post.frontmatter.title}
            />
        </div>
    </div>
</Layout>

<style>
    .container {
        position: relative;
        display: flex;
    }
    .sidebar {
        align-self: flex-start;
        top: 0;
        position: sticky;
        padding: 1.5rem;
        max-width: 15vw;
    }
    .center-content {
        flex: 1;
    }
</style>
